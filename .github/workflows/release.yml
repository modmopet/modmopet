name: Release
on:
  push:
    branches:
    - main
    - rc
    - beta
    - nightly
    - hotfix
    - "*.x"

env:
  FLUTTER_VERSION: '3.10.x'

permissions:
  contents: write

jobs:
  get-version:
    uses: shiipou/github-actions/.github/workflows/build-flutter.yml@1-fix-flutter-release-didnt-work
    with:
      prerelease-branches: rc,beta,nightly,hotfix
  get-build:
    uses: shiipou/github-actions/.github/workflows/increment-variable.yml@1-fix-flutter-release-didnt-work
    with:
      variable-name: build-number
  build:
    needs: get-version
    uses: shiipou/github-actions/.github/workflows/build-flutter.yml@1-fix-flutter-release-didnt-work
    with:
      package-name: ModMopet
      version: ${{ needs.get-version.outputs.version }}
      build: ${{ needs.get-build.outputs.value }}
  release:
    needs: build
    uses: shiipou/github-actions/.github/workflows/release.yml@1-fix-flutter-release-didnt-work
    with:
      version:  ${{ needs.get-version.outputs.version }}
      changelogs: ${{ needs.get-version.outputs.changelogs }}
      is-prerelease: ${{ needs.get-version.outputs.is-prerelease }}
      download-artifacts: true
      assets: artifacts/*/*
